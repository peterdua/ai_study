# AI 教学平台 - 实施步骤与时间规划

## 一、整体时间规划（8-10周）

```
Week 1-2: 基础架构搭建
Week 3-5: 核心播放器开发
Week 6:   问答交互系统
Week 7-8: 测试与优化
Week 9+:  次级/次次级需求（按优先级排期）
```

## 二、Phase 1: 基础架构搭建（Week 1-2）

### Week 1: 项目初始化

#### Day 1-2: 前端项目搭建
```bash
# 创建React项目
npm create vite@latest aistudy-frontend -- --template react-ts

# 安装核心依赖
npm install \
  react-router-dom \
  zustand \
  antd \
  axios \
  video.js \
  howler \
  @ant-design/icons

# 配置项目结构
src/
├── components/        # 组件
├── store/            # Zustand状态管理
├── api/              # API接口
├── hooks/            # 自定义Hooks
├── types/            # TypeScript类型定义
├── utils/            # 工具函数
└── pages/            # 页面组件
```

**交付物**:
- ✅ 前端项目框架
- ✅ 路由配置
- ✅ 基础UI布局

#### Day 3-4: 后端项目搭建
```bash
# 创建FastAPI项目
mkdir aistudy-backend && cd aistudy-backend
python -m venv venv
source venv/bin/activate

# 安装依赖
pip install \
  fastapi \
  uvicorn \
  sqlalchemy \
  psycopg2-binary \
  python-jose \
  passlib \
  python-multipart \
  alembic \
  redis \
  celery
```

**目录结构**:
```
backend/
├── main.py              # FastAPI应用入口
├── models/              # 数据库模型
├── schemas/             # Pydantic模型
├── api/                 # API路由
│   ├── courses.py
│   ├── users.py
│   └── progress.py
├── services/            # 业务逻辑
│   ├── tts_service.py
│   ├── digital_human_service.py
│   └── storage_service.py
├── core/                # 核心配置
│   ├── config.py
│   └── security.py
└── alembic/             # 数据库迁移
```

**交付物**:
- ✅ FastAPI项目框架
- ✅ 数据库ORM配置
- ✅ JWT认证系统

#### Day 5: 数据库设计与迁移
```sql
-- 创建所有表
CREATE TABLE courses (...);
CREATE TABLE course_pages (...);
CREATE TABLE questions (...);
CREATE TABLE users (...);
CREATE TABLE learning_progress (...);
CREATE TABLE answer_records (...);

-- 创建索引
CREATE INDEX idx_progress_user_course ON learning_progress(user_id, course_id);
```

**交付物**:
- ✅ 数据库表设计完成
- ✅ Alembic迁移脚本
- ✅ 种子数据（测试用）

### Week 2: 基础服务集成

#### Day 1-2: 文件存储服务
```python
# services/storage_service.py
class OSSStorageService:
    """阿里云OSS文件存储"""
    
    def upload(self, file_path: str, object_key: str) -> str:
        """上传文件并返回CDN URL"""
        # 实现OSS上传逻辑
        pass
    
    def get_signed_url(self, object_key: str) -> str:
        """获取临时访问URL"""
        pass
```

**交付物**:
- ✅ OSS上传功能
- ✅ CDN配置
- ✅ 文件访问权限控制

#### Day 3-4: 用户认证系统
```python
# api/auth.py
@app.post("/api/v1/auth/register")
async def register(user: UserCreate):
    """用户注册"""
    pass

@app.post("/api/v1/auth/login")
async def login(credentials: LoginCredentials):
    """用户登录，返回JWT Token"""
    pass

@app.get("/api/v1/auth/me")
async def get_current_user(token: str = Depends(oauth2_scheme)):
    """获取当前用户信息"""
    pass
```

**交付物**:
- ✅ 注册/登录接口
- ✅ JWT Token生成与验证
- ✅ 密码加密存储

#### Day 5: Docker容器化
```yaml
# docker-compose.yml
services:
  frontend:
    build: ./frontend
    ports: ["3000:3000"]
  
  backend:
    build: ./backend
    ports: ["8000:8000"]
    environment:
      - DATABASE_URL=...
      - REDIS_URL=...
  
  postgres:
    image: postgres:15
    volumes: [postgres_data:/var/lib/postgresql/data]
  
  redis:
    image: redis:7-alpine
```

**交付物**:
- ✅ Docker配置完成
- ✅ 开发环境一键启动
- ✅ CI/CD基础配置

---

## 三、Phase 2: 核心播放器开发（Week 3-5）

### Week 3: PPT展示与基础播放

#### Day 1-2: PPT展示组件
```tsx
// components/CoursePlayer/PPTDisplay.tsx
export const PPTDisplay: React.FC<PPTDisplayProps> = ({
  imageUrl,
  pageNumber,
  totalPages
}) => {
  return (
    <div className="ppt-display">
      <img src={imageUrl} alt={`Page ${pageNumber}`} />
      <div className="page-indicator">{pageNumber} / {totalPages}</div>
    </div>
  );
};
```

**交付物**:
- ✅ PPT图片展示组件
- ✅ 翻页动画效果
- ✅ 响应式布局

#### Day 3-4: 视频播放器集成
```tsx
// components/CoursePlayer/DigitalHuman.tsx
export const DigitalHuman: React.FC = () => {
  const videoRef = useRef<HTMLVideoElement>(null);
  
  return (
    <div className="digital-human">
      <video ref={videoRef} playsInline controls={false} />
    </div>
  );
};
```

**交付物**:
- ✅ Video.js集成
- ✅ 视频播放控制
- ✅ 播放状态管理

#### Day 5: 播放控制面板
```tsx
// components/CoursePlayer/PlayerControls.tsx
export const PlayerControls: React.FC = () => {
  return (
    <div className="controls">
      <Button icon={<PlayCircleOutlined />} onClick={play} />
      <Button icon={<PauseCircleOutlined />} onClick={pause} />
      <Select options={[0.5, 1.0, 1.5, 2.0]} onChange={setSpeed} />
    </div>
  );
};
```

**交付物**:
- ✅ 播放/暂停控制
- ✅ 倍速播放
- ✅ 进度条显示

### Week 4: TTS与数字人集成

#### Day 1-2: TTS服务集成
```python
# services/tts_service.py
from openai import AsyncOpenAI

class TTSService:
    async def generate(self, text: str, voice: str = "alloy") -> Path:
        """调用OpenAI TTS生成音频"""
        response = await self.client.audio.speech.create(
            model="tts-1",
            voice=voice,
            input=text
        )
        # 保存并返回文件路径
        return audio_path
```

**测试**:
- 生成多段测试音频
- 验证音质和发音准确度
- 测试中文支持（可能需要Azure TTS）

**交付物**:
- ✅ OpenAI TTS集成
- ✅ 音频生成API
- ✅ 音频文件缓存

#### Day 3-5: 数字人服务集成
```python
# services/digital_human_service.py
class DigitalHumanService:
    async def generate_video(
        self, 
        avatar_id: str, 
        audio_url: str
    ) -> str:
        """调用D-ID API生成数字人视频"""
        # 创建任务
        talk_id = await self.create_talk(avatar_id, audio_url)
        
        # 轮询等待完成
        video_url = await self.poll_completion(talk_id)
        
        return video_url
```

**测试**:
- 测试不同数字人形象
- 验证唇形同步效果
- 测试视频生成时间（通常2-5分钟）

**交付物**:
- ✅ D-ID API集成
- ✅ 视频生成任务管理
- ✅ 异步任务队列（Celery）

### Week 5: 同步播放与课程预处理

#### Day 1-3: 音视频同步
```typescript
// 核心同步逻辑
useEffect(() => {
  const syncInterval = setInterval(() => {
    if (videoRef.current && audioRef.current) {
      const diff = Math.abs(
        videoRef.current.currentTime - audioRef.current.currentTime
      );
      
      if (diff > 0.3) {
        // 强制同步
        videoRef.current.currentTime = audioRef.current.currentTime;
      }
    }
  }, 100);
  
  return () => clearInterval(syncInterval);
}, []);
```

**测试**:
- 不同网络条件下的同步测试
- 倍速播放时的同步测试
- 长时间播放的稳定性测试

**交付物**:
- ✅ 音视频同步机制
- ✅ 播放状态精确控制
- ✅ 异常恢复机制

#### Day 4-5: 课程预处理脚本
```python
# scripts/preprocess_course.py
async def main():
    """处理完整课程"""
    
    # 1. PPT → 图片
    images = convert_ppt_to_images("slides.pptx")
    
    # 2. 文稿 → TTS音频
    audios = await generate_audio_batch(scripts)
    
    # 3. 音频 → 数字人视频
    videos = await generate_video_batch(audios)
    
    # 4. 上传到OSS
    urls = await upload_all(images, audios, videos)
    
    # 5. 保存到数据库
    await save_course_data(urls)
```

**交付物**:
- ✅ 自动化预处理脚本
- ✅ 批量处理能力
- ✅ 进度监控与日志

---

## 四、Phase 3: 问答交互系统（Week 6）

### Day 1-2: 问答弹窗UI
```tsx
// components/CoursePlayer/QuestionModal.tsx
export const QuestionModal: React.FC<QuestionModalProps> = ({
  question,
  onComplete
}) => {
  const [selectedOption, setSelectedOption] = useState<string | null>(null);
  const [showResult, setShowResult] = useState(false);
  
  return (
    <Modal visible={true}>
      <h3>{question.question_text}</h3>
      <Radio.Group value={selectedOption} onChange={setSelectedOption}>
        {question.options.map(opt => (
          <Radio key={opt.id} value={opt.id}>{opt.text}</Radio>
        ))}
      </Radio.Group>
      {showResult && <Alert message={explanation} />}
      <Button onClick={handleSubmit}>提交答案</Button>
    </Modal>
  );
};
```

**交付物**:
- ✅ 问答弹窗组件
- ✅ 选择题交互
- ✅ 答案解析展示

### Day 3-4: 答题记录与进度追踪
```python
# api/progress.py
@app.post("/api/v1/progress")
async def update_progress(progress: ProgressUpdate):
    """更新学习进度"""
    record = LearningProgress(
        user_id=current_user.id,
        page_id=progress.page_id,
        completed=progress.completed,
        time_spent=progress.time_spent
    )
    db.add(record)
    db.commit()
    return {"status": "success"}

@app.post("/api/v1/answers")
async def submit_answer(answer: AnswerSubmit):
    """提交答题记录"""
    record = AnswerRecord(
        user_id=current_user.id,
        question_id=answer.question_id,
        user_answer=answer.answer,
        is_correct=answer.answer == question.correct_answer
    )
    db.add(record)
    db.commit()
    return {"is_correct": record.is_correct}
```

**交付物**:
- ✅ 进度追踪API
- ✅ 答题记录API
- ✅ 学习数据统计

### Day 5: 集成测试
- 完整播放流程测试
- 问答打断流程测试
- 多页面连续学习测试
- 进度恢复测试

---

## 五、Phase 4: 测试与优化（Week 7-8）

### Week 7: 功能测试与修复

#### Day 1-2: 单元测试
```python
# tests/test_tts_service.py
@pytest.mark.asyncio
async def test_generate_audio():
    service = TTSService()
    audio_path = await service.generate("测试文本", "alloy")
    assert audio_path.exists()
    assert audio_path.suffix == ".mp3"
```

#### Day 3-4: 集成测试
- API端到端测试
- 前后端联调测试
- 边界条件测试

#### Day 5: Bug修复
- 收集测试中发现的问题
- 优先级排序
- 集中修复

### Week 8: 性能优化

#### Day 1-2: 前端性能优化
```typescript
// 代码分割
const CoursePlayer = lazy(() => import('./CoursePlayer'));

// 图片懒加载
<img loading="lazy" src={imageUrl} />

// 资源预加载
useEffect(() => {
  const link = document.createElement('link');
  link.rel = 'prefetch';
  link.href = nextPageVideo;
  document.head.appendChild(link);
}, [currentPage]);
```

**优化项**:
- ✅ 代码分割与懒加载
- ✅ 资源预加载
- ✅ 图片WebP格式转换
- ✅ CDN配置优化

#### Day 3-4: 后端性能优化
```python
# 添加Redis缓存
@cache(expire=3600)
async def get_course(course_id: str):
    return await db.query(Course).filter(...).first()

# 数据库查询优化
query = (
    db.query(Course)
    .options(joinedload(Course.pages))
    .filter(Course.id == course_id)
)
```

**优化项**:
- ✅ Redis缓存
- ✅ 数据库查询优化
- ✅ API响应压缩
- ✅ 连接池配置

#### Day 5: 制作示例课程
- 准备15页PPT
- 编写讲解文稿
- 配置3-5个问题
- 运行预处理脚本
- 完整演示验收

---

## 六、时间规划甘特图

```
任务                  Week1  Week2  Week3  Week4  Week5  Week6  Week7  Week8
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
前端项目搭建          ████
后端项目搭建          ████
数据库设计            ████
基础服务集成                ████
PPT展示组件                       ████
视频播放器                        ████
TTS集成                                 ████
数字人集成                              ████████
同步播放                                      ████
课程预处理                                    ████
问答系统                                            ████
进度追踪                                            ████
功能测试                                                  ████
性能优化                                                        ████
示例课程制作                                                    ████
```

## 七、里程碑与验收标准

### Milestone 1: 基础架构完成（Week 2结束）
- ✅ 前后端项目可运行
- ✅ 数据库表创建完成
- ✅ 用户认证可用
- ✅ 文件上传功能正常

### Milestone 2: 播放器原型（Week 5结束）
- ✅ 可以播放PPT+数字人视频
- ✅ 支持播放/暂停/倍速
- ✅ 音视频基本同步
- ✅ 可以自动翻页

### Milestone 3: 完整MVP（Week 6结束）
- ✅ 问答交互功能完整
- ✅ 学习进度正确记录
- ✅ 可以完整学完一门课程
- ✅ 答题记录可查询

### Milestone 4: 生产就绪（Week 8结束）
- ✅ 所有功能测试通过
- ✅ 性能达标（加载<3秒）
- ✅ 至少1门完整示例课程
- ✅ 部署文档完善

## 八、风险与应对

### 风险1: 数字人生成时间过长
**问题**: D-ID生成单个视频需要2-5分钟
**应对**: 
- 采用预处理模式，课程上线前批量生成
- 使用Celery异步任务队列
- 显示生成进度条

### 风险2: 音视频同步问题
**问题**: 不同浏览器、网络条件下可能不同步
**应对**:
- 实现精确的同步检测机制（100ms检查一次）
- 提供手动同步按钮
- 允许用户反馈同步问题

### 风险3: TTS中文效果不佳
**问题**: OpenAI TTS对中文支持有限
**应对**:
- 备选方案：Azure TTS（中文效果更好）
- 或使用国内TTS服务（阿里云、讯飞）
- 预算允许可用真人录音

### 风险4: 开发进度延期
**问题**: 某个阶段可能超时
**应对**:
- 每周进行进度检查
- 及时调整计划
- 必要时增加人手或削减功能

## 九、团队配置建议

### 最小团队（2人）
- **全栈工程师1名**: 负责前端+后端核心功能
- **全栈工程师1名**: 负责AI服务集成+课程预处理

### 理想团队（3-4人）
- **前端工程师1名**: 播放器UI+交互
- **后端工程师1名**: API+数据库+部署
- **AI工程师1名**: TTS/数字人集成+优化
- **产品/测试1名**: 需求管理+测试+课程制作

## 十、后续优化方向

### 短期优化（1-2个月）
- 数字人表情更自然
- 支持更多问题类型（多选、填空）
- 学习报告可视化
- 移动端适配

### 中期优化（3-6个月）
- 自研数字人（Wav2Lip）降低成本
- 数字人手势动作
- 语音识别（用户口述答题）
- 个性化学习路径

### 长期愿景（6个月+）
- 虚拟直播教室
- 多人协同学习
- AR/VR沉浸式学习
- AI自动生成课程
