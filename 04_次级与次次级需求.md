# AI 教学平台 - 次级与次次级需求

## 一、次级需求：在线管理平台

### 1.1 课程配置系统

#### 可视化拖拽编排
- **技术方案**: React DnD Kit / react-beautiful-dnd
- **核心功能**:
  - 拖拽AI生成的课程模块
  - 自定义模块顺序
  - 配置必修/选修属性
  - 设置学习时长要求

```typescript
// 课程配置数据结构
interface CourseConfig {
  courseId: string;
  courseName: string;
  type: 'required' | 'optional';
  estimatedDuration: number;
  modules: Array<{
    moduleId: string;
    moduleName: string;
    order: number;
    required: boolean;
    minDuration: number;
  }>;
  unlockConditions: {
    completePrevious: boolean;
    minScore: number;
    practiceRequired: boolean;
  };
}
```

#### 后台管理界面
- 模块库：展示所有可用模块
- 画布区：拖拽组装课程结构
- 配置面板：设置详细参数
- 预览功能：实时预览课程效果

### 1.2 学习轨迹追踪

#### 数据采集维度
```sql
CREATE TABLE learning_behaviors (
    id UUID PRIMARY KEY,
    user_id UUID,
    course_id UUID,
    page_id UUID,
    
    -- 时间维度
    session_start TIMESTAMP,
    session_end TIMESTAMP,
    time_spent INTEGER,
    active_time INTEGER,
    
    -- 交互维度
    pause_count INTEGER,
    replay_count INTEGER,
    fast_forward_count INTEGER,
    speed_changes JSONB,
    
    -- 完成情况
    completed BOOLEAN,
    video_completion_rate FLOAT,
    interaction_events JSONB
);
```

#### 可视化仪表盘
- **学习时间轴**: 展示用户完整学习过程
- **行为热力图**: 哪些内容被反复观看
- **进度统计**: 课件观看率、练习完成率
- **历史回溯**: 选择时间段查看学习状态

### 1.3 自动推送练习

#### 触发机制
```python
# 章节完成自动推送
async def on_chapter_completed(user_id, chapter_id):
    # 1. 生成练习任务
    practices = get_chapter_practices(chapter_id)
    task = create_practice_task(user_id, practices)
    
    # 2. 锁定下一章节
    lock_next_chapter(user_id, chapter_id)
    
    # 3. 发送通知
    send_notification(user_id, f"请完成第{chapter_id}章练习后继续")

# 练习完成自动解锁
async def on_practice_completed(user_id, chapter_id):
    if practice_score >= 80:
        unlock_next_chapter(user_id, chapter_id)
        send_notification(user_id, "恭喜解锁下一章！")
```

---

## 二、次次级需求：实时答疑系统

### 2.1 智能答疑架构

```
用户提问
    ↓
[意图识别] GPT-4
    ↓
[向量检索] Embeddings + Pinecone
    ↓
[多路召回]
├─ 答疑库 (历史QA)
├─ 课件内容
└─ 知识图谱
    ↓
[LLM生成] GPT-4 + RAG
    ↓
[返回答案 + 引用]
```

### 2.2 向量检索实现

#### 知识库构建
```python
# 1. 导入历史答疑记录
qa_pairs = load_qa_history()  # 人工整理的答疑记录

# 2. 为每个QA生成向量
for qa in qa_pairs:
    embedding = openai.embeddings.create(
        model="text-embedding-3-large",
        input=qa["question"]
    )
    
    # 3. 存入向量数据库
    pinecone_index.upsert([(
        qa["id"],
        embedding.data[0].embedding,
        {"question": qa["question"], "answer": qa["answer"]}
    )])

# 4. 索引课件内容
for page in course_pages:
    embedding = openai.embeddings.create(
        model="text-embedding-3-large",
        input=page["script"]
    )
    pinecone_index.upsert([(page["id"], embedding, metadata)])
```

#### 智能回答
```python
async def answer_question(question: str, course_id: str):
    # 1. 向量检索相似内容
    results = pinecone_index.query(
        vector=get_embedding(question),
        top_k=5,
        filter={"course_id": course_id}
    )
    
    # 2. 构建上下文
    context = build_context_from_results(results)
    
    # 3. LLM生成回答
    response = openai.chat.completions.create(
        model="gpt-4-turbo",
        messages=[
            {"role": "system", "content": "你是课程助教..."},
            {"role": "user", "content": f"问题: {question}\n参考: {context}"}
        ]
    )
    
    # 4. 返回答案+引用
    return {
        "answer": response.choices[0].message.content,
        "citations": extract_citations(results)
    }
```

### 2.3 误解纠错功能

#### 关键词监测
```python
misconceptions = [
    {
        "incorrect": ["15天", "半个月"],
        "correct": "30天",
        "context": "试用期",
        "page": 6
    },
    {
        "incorrect": ["999元"],
        "correct": "最低799元/年",
        "context": "价格",
        "page": 12
    }
]

async def check_misconception(user_message: str):
    for mc in misconceptions:
        if any(wrong in user_message for wrong in mc["incorrect"]):
            return {
                "type": "correction",
                "message": f"您提到的{mc['incorrect'][0]}有误，实际是{mc['correct']}",
                "page": mc["page"],
                "screenshot": get_page_screenshot(mc["page"])
            }
```

#### 纠错展示
- 高亮错误信息（红色删除线）
- 显示正确信息（绿色加粗）
- 提供课件截图证据
- 跳转按钮直达原文页面

### 2.4 答疑界面

#### 嵌入课程播放器
```tsx
// 右侧浮动答疑面板
<FloatButton.Group>
  <FloatButton 
    icon={<QuestionCircleOutlined />}
    onClick={toggleQAPanel}
    badge={{ count: unreadCount }}
  />
</FloatButton.Group>

<Drawer 
  title="课程答疑"
  placement="right"
  open={qaVisible}
  width={400}
>
  <QAChatInterface />
</Drawer>
```

#### 聊天界面功能
- 消息记录持久化
- 支持文本+图片提问
- AI回答带引用来源
- 误解自动纠正提醒
- 一键跳转到课件页

---

## 三、技术选型与成本

### 3.1 次级需求技术栈
- **前端**: Ant Design Pro (管理后台)
- **拖拽**: @dnd-kit/core
- **图表**: ECharts / Apache ECharts
- **时间轴**: Ant Design Timeline

### 3.2 次次级需求技术栈
- **向量数据库**: Pinecone ($70/月) 或 Milvus (自部署)
- **Embeddings**: text-embedding-3-large ($0.13/1M tokens)
- **LLM**: GPT-4-turbo ($10/1M tokens)
- **知识库工具**: LangChain / LlamaIndex

### 3.3 成本估算
- **次级需求**: 主要是开发成本，运营成本可忽略
- **次次级需求**: 
  - Pinecone: $70/月
  - Embeddings: 约$20/月
  - LLM调用: 约$200/月（假设1000次答疑）
  - **总计**: ~$300/月

---

## 四、实施优先级建议

### Phase 1（核心功能）- 必须实现
- ✅ 课程播放器
- ✅ 问答交互
- ✅ 基础进度追踪

### Phase 2（管理功能）- 建议实现
- 课程配置后台（拖拽编排）
- 学习轨迹仪表盘
- 自动推送练习

### Phase 3（AI增强）- 可选实现
- 智能答疑系统
- 误解纠错
- 知识图谱

**建议**: 先完成Phase 1验证产品可行性，再根据用户反馈决定是否开发Phase 2和3
